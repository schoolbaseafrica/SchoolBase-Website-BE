#!/usr/bin/env sh

# Change to git root directory to ensure we're in the project root
cd "$(git rev-parse --show-toplevel)" || exit 1

# Add common Node.js installation paths to PATH
# This ensures node/npm/npx are available regardless of installation method
export PATH="$HOME/.npm-global/bin:/opt/homebrew/bin:/usr/local/bin:$PATH"

# Try to load nvm if it exists (common on macOS/Linux)
if [ -s "$HOME/.nvm/nvm.sh" ]; then
  . "$HOME/.nvm/nvm.sh" 2>/dev/null || true
fi

# Add node_modules/.bin to PATH
export PATH="./node_modules/.bin:$PATH"

# Try to run lint-staged directly from node_modules/.bin first (most reliable)
if [ -f "./node_modules/.bin/lint-staged" ]; then
  ./node_modules/.bin/lint-staged
elif command -v npx >/dev/null 2>&1; then
  # Fallback: use npx to run lint-staged (npx will find it in node_modules)
  npx lint-staged
elif command -v npm >/dev/null 2>&1; then
  # Last resort: use npm to run lint-staged
  npm run lint-staged 2>/dev/null || npm exec lint-staged
else
  echo "Error: Could not find Node.js, npm, or lint-staged."
  echo "Please ensure Node.js is installed and run 'npm install' first."
  exit 1
fi
